<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Confirmation - Food Delivery</title>
    <meta name="description" content="Thank you for your order. Your food is on the way!">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="../checkOut/checkOut.css">
</head>
<body>
    <!-- Accessibility skip link -->
    <a href="#main-content" class="skip-to-content">Skip to content</a>

    <!-- Header -->
    <header class="site-header" role="banner">
        <div class="logo-container">
            <a href="../index.html" class="back-link">
                <span class="logo-text"><i class="fas fa-utensils logo-icon"></i>Food<span class="logo-accent">Delivery</span></span>
            </a>
        </div>
    </header>

    <!-- Main content -->
    <main id="main-content" class="containerCheckOut">
        <!-- Progress indicator -->
        <nav class="checkout-progress" aria-label="Checkout progress" role="navigation">
            <a href="../viewCart/viewCart.html" class="progress-step completed" aria-label="Go to cart page" title="View cart">
                <div class="step-icon" aria-hidden="true">1</div>
                <span class="step-label">Cart</span>
            </a>
            <a href="../checkOut/checkOut.html" class="progress-step completed" aria-label="Go to checkout page" title="Complete checkout">
                <div class="step-icon" aria-hidden="true">2</div>
                <span class="step-label">Checkout</span>
            </a>
            <a href="confirm.html" class="progress-step completed active" aria-label="Current page: Order confirmation" title="Order confirmation" aria-current="page">
                <div class="step-icon" aria-hidden="true">3</div>
                <span class="step-label">Confirmation</span>
            </a>
        </nav>

        <!-- Order Confirmation Section -->
        <div class="order-confirmation" aria-live="polite">
            <div class="confirmation-icon" aria-hidden="true">
                <i class="fas fa-check-circle"></i>
            </div>
            <h1 class="confirmation-title">Order Confirmed!</h1>
            <p class="confirmation-message">Thank you for your order. We've received your payment and are preparing your delicious meal. Your order details are shown below.</p>
            
            <!-- Order Details -->
            <div class="order-details">
                <h2 class="userInfo">Order Details</h2>
                
                <div class="order-details-item">
                    <span class="order-details-label">Order Number:</span>
                    <span class="order-details-value" id="order-number">FD-20250407-12345</span>
                </div>
                
                <div class="order-details-item">
                    <span class="order-details-label">Order Date:</span>
                    <span class="order-details-value" id="order-date">April 7, 2025</span>
                </div>
                
                <div class="order-details-item">
                    <span class="order-details-label">Delivery Address:</span>
                    <span class="order-details-value" id="delivery-address">123 Main Street, City, Country</span>
                </div>
                
                <div class="order-details-item">
                    <span class="order-details-label">Payment Method:</span>
                    <span class="order-details-value" id="payment-method">Credit Card (**** 1234)</span>
                </div>
                
                <div class="order-details-item">
                    <span class="order-details-label">Estimated Delivery:</span>
                    <span class="order-details-value" id="estimated-delivery">30-45 minutes</span>
                </div>
            </div>
            
            <!-- Order Items -->
            <div class="order-details">
                <h2 class="userInfo">Order Items</h2>
                <div id="order-items">
                    <!-- Order items will be populated dynamically -->
                </div>
                
                <div class="order-details-item total-price">
                    <span class="order-details-label">Total:</span>
                    <span class="order-details-value" id="total-price">$45.90</span>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="action-buttons">
                <a href="../index.html" class="return-home">
                    <i class="fas fa-home" aria-hidden="true"></i>
                    Return to Home
                </a>
                
                <button class="print-order" onclick="window.print();" aria-label="Print your order confirmation">
                    <i class="fas fa-print" aria-hidden="true"></i>
                    Print Order
                </button>
            </div>
            
            <!-- Tracking Information -->
            <div class="tracking-info">
                <h2 class="userInfo">Track Your Order</h2>
                <p>You can track the status of your order in real-time using the order number above. Our delivery partner will contact you when they're close to your location.</p>
                
                <div class="tracking-steps">
                    <div class="tracking-step completed">
                        <div class="tracking-icon">
                            <i class="fas fa-check-circle" aria-hidden="true"></i>
                        </div>
                        <div class="tracking-content">
                            <h3>Order Received</h3>
                            <p>We've received your order and are processing it.</p>
                        </div>
                    </div>
                    
                    <div class="tracking-step active">
                        <div class="tracking-icon">
                            <i class="fas fa-utensils" aria-hidden="true"></i>
                        </div>
                        <div class="tracking-content">
                            <h3>Preparing</h3>
                            <p>Our chefs are preparing your delicious meal.</p>
                        </div>
                    </div>
                    
                    <div class="tracking-step">
                        <div class="tracking-icon">
                            <i class="fas fa-motorcycle" aria-hidden="true"></i>
                        </div>
                        <div class="tracking-content">
                            <h3>On the Way</h3>
                            <p>Your order is on its way to your location.</p>
                        </div>
                    </div>
                    
                    <div class="tracking-step">
                        <div class="tracking-icon">
                            <i class="fas fa-home" aria-hidden="true"></i>
                        </div>
                        <div class="tracking-content">
                            <h3>Delivered</h3>
                            <p>Your order has been delivered. Enjoy!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Notification System -->
        <div class="notification success" id="notification">
            <div class="notification-icon">
                <i class="fas fa-check-circle" aria-hidden="true"></i>
            </div>
            <div class="notification-content">
                <h3 class="notification-title">Order Confirmed!</h3>
                <p class="notification-message">Your order has been successfully placed and is being prepared.</p>
            </div>
            <button class="notification-close" aria-label="Close notification">
                <i class="fas fa-times" aria-hidden="true"></i>
            </button>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="site-footer confirmation-footer">
        <div class="footer-container">
            <div class="footer-section">
                <h3>Food Delivery</h3>
                <p>Bringing delicious meals right to your doorstep.</p>
            </div>
            <div class="footer-section">
                <h3>Contact Us</h3>
                <p>Email: support@fooddelivery.com</p>
                <p>Phone: (123) 456-7890</p>
            </div>
            <div class="footer-section">
                <h3>Follow Us</h3>
                <div class="social-icons">
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f" aria-hidden="true"></i></a>
                    <a href="#" aria-label="Twitter"><i class="fab fa-twitter" aria-hidden="true"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram" aria-hidden="true"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Food Delivery. All rights reserved.</p>
        </div>
    </footer>
    
    <script>
        // Check if order was completed before accessing this page
        function checkOrderCompletion() {
            // In a real app, this would check server-side session or authentication
            if (sessionStorage.getItem('orderCompleted') !== 'true') {
                // Redirect back to checkout if trying to access confirmation directly
                window.location.href = '../checkOut/checkOut.html';
                return false;
            }
            return true;
        }

        // Run check immediately on page load before any rendering
        if (!checkOrderCompletion()) {
            // Script execution will stop if redirected
            throw new Error("Access validation failed");
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // Get order data from session storage
            const orderData = JSON.parse(sessionStorage.getItem('orderData'));
            
            if (!orderData) {
                console.error("No order data found");
                return;
            }
            
            // Update order information
            document.getElementById('order-number').textContent = orderData.orderNumber || 'FD-20250407-12345';
            document.getElementById('order-date').textContent = orderData.orderDate || new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('estimated-delivery').textContent = orderData.estimatedDelivery || '30-45 minutes';
            
            // Update customer details if available
            if (orderData.details) {
                document.getElementById('delivery-address').textContent = orderData.details.address || '123 Main Street, City, Country';
                // Add optional customer info if defined in the page
                if (document.getElementById('customer-name')) {
                    document.getElementById('customer-name').textContent = orderData.details.name;
                }
                if (document.getElementById('customer-email')) {
                    document.getElementById('customer-email').textContent = orderData.details.email;
                }
            }
            
            // Update payment method display
            const paymentMethodElement = document.getElementById('payment-method');
            if (paymentMethodElement) {
                // Try to get the payment method from session storage first, then local storage as fallback
                const storedPaymentMethod = sessionStorage.getItem('selectedPaymentMethod') || 
                                           localStorage.getItem('selectedPaymentMethod');
                
                if (storedPaymentMethod) {
                    console.log('Retrieved payment method:', storedPaymentMethod);
                    paymentMethodElement.textContent = storedPaymentMethod;
                } else {
                    console.log('No payment method found in storage, using default');
                    paymentMethodElement.textContent = 'Credit Card';
                }
            }
            
            // Update total price
            if (orderData.total) {
                document.getElementById('total-price').textContent = `$${orderData.total}`;
            }
            
            // Populate order items
            const orderItemsContainer = document.getElementById('order-items');
            orderItemsContainer.innerHTML = ''; // Clear any existing content
            
            // Use order items from session storage if available, otherwise fallback to sample data
            const orderItems = orderData.items || [
                { name: 'Margherita Pizza', price: 12.99 },
                { name: 'Chicken Caesar Salad', price: 9.95 },
                { name: 'Garlic Bread', price: 3.99 },
                { name: 'Iced Tea', price: 2.99 },
            ];
            
            // Generate order items HTML
            orderItems.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'order-details-item';
                
                const itemInfo = document.createElement('span');
                itemInfo.className = 'order-details-label';
                itemInfo.textContent = item.name;
                
                const itemPrice = document.createElement('span');
                itemPrice.className = 'order-details-value';
                itemPrice.textContent = `$${parseFloat(item.price).toFixed(2)}`;
                
                itemElement.appendChild(itemInfo);
                itemElement.appendChild(itemPrice);
                orderItemsContainer.appendChild(itemElement);
            });
            
            // Show notification immediately on page load
            document.getElementById('notification').classList.add('show');
            
            // Hide notification after 5 seconds
            setTimeout(() => {
                document.getElementById('notification').classList.remove('show');
            }, 5000);
            
            // Add event listener to close notification
            document.querySelector('.notification-close').addEventListener('click', function() {
                document.getElementById('notification').classList.remove('show');
            });

            // Create action for returning to shop
            document.querySelector('.return-home').addEventListener('click', function() {
                // Clear the orderCompleted flag when returning to shop
                sessionStorage.removeItem('orderCompleted');
            });
        });
    </script>
</body>
</html>
